<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <title>Cloud Computing &amp; Cloud Hosting Services</title>
    <meta charset="utf-8" />
    
      <meta description="Google Cloud Platform lets you build and host applications and websites, store data, and analyze data on Google's scalable infrastructure.">
    
    <link rel="shortcut icon" href="/images/gcp-favicon.ico">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">

    <!--[if lt IE 9]>
    <script src="/js/html5.js"></script>
    <![endif]-->

    <!-- Build date: 28 August 2014 -->  


    <meta name="google-site-verification" content="8dOEM3Xenm6yaBc83y2WKgqQG0iHI7Ph6Rl_YLIZLQ8" />
    <meta name="viewport" content="initial-scale=1, minimum-scale=1, width=device-width">

    <!-- GSAP animation frameworks -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script src="//www.gstatic.com/external_hosted/gsap/TweenMax.min.js"></script>
    <script src="//www.gstatic.com/external_hosted/gsap/TimelineMax.min.js"></script>
    <script src="/js/floodlight.js"></script>

    <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,300,400,600,700" rel="stylesheet">
    <link href="//www.google.com/css/maia.experimental.css" rel="stylesheet">
    <link href="/css/maia-cloud.css" rel="stylesheet"/>
    <link href="/css/default.css" rel="stylesheet">
  </head>
  <body>
  <div id="maia-header">
    <div class="maia-aux">
      <h1><a href="/"><img src="/images/gcp-logo.png" alt="Cloud Platform" data-retina="383x48"></a></h1>

<div class="search-container">
  <form action="/search" class="maia-search">
    <input type="text" placeholder="Search this site" name="q">
    <button class="maia-button" type="submit" data-g-event="Maia: Button" data-g-action="Maia: Primary – Header" data-g-label="Search">
      <span class="maia-search-icon">Pesquisa</span>
    </button>
  </form>
  <div class="cloud-social">

    <div class="cloud-signed-in">
      <a href="https://console.developers.google.com/" event="autotrack-data-g" data-g-event="Global Nav" data-g-action="Nav Bar" data-g-label="Go to my console">Go to Cloud Console</a>
    </div>

  </div>

</div>

</div>

    </div>
  </div>
  <div id="maia-nav-x" class="maia-nav">
    <div class="maia-aux">
   <div class="cp-cta">
     <a class="cp-track maia-button maia-button-secondary white-button" href="/contact/" event="autotrack-data-g" data-g-event="Global Nav" data-g-action="Contact Sales" data-g-label="Global Nav: Click" >Falar c/ equipe de vendas</a>
     
       <a class="cp-track maia-button blue-button" href="https://console.developers.google.com?getstarted=https://cloud.google.com" event="autotrack-data-g" data-g-event="Global Nav" data-g-action="Try It Now" data-g-label="Global Nav: Click" style="color: #fff;">Faça o teste agora</a>
     
   </div>
      <ul>
        <li >
            <a href="/why-google/" event="autotrack-data-g" data-g-event="Global Nav" data-g-action="Nav Bar" data-g-label="Why Google">
            Por que o Google
            </a>
        </li>
        <li  id="main-nav-product-dropdown" class="dropdown">
            <a href="/products/" event="autotrack-data-g" data-g-event="Global Nav" data-g-action="Nav Bar" data-g-label="Products">
            Produtos
            </a>
        </li>
        <li >
            <a href="/solutions/" event="autotrack-data-g" data-g-event="Global Nav" data-g-action="Nav Bar" data-g-label="Solutions">
            Soluções
            </a>
        </li>
        <li >
            <a href="/customers/" event="autotrack-data-g" data-g-event="Global Nav" data-g-action="Nav Bar" data-g-label="Customers">
            Clientes
            </a>
        </li>
        <li  class="active" >
            <a href="/developers/" event="autotrack-data-g" data-g-event="Global Nav" data-g-action="Nav Bar" data-g-label="Developers">
          Desenvolvedores
            </a>
        </li>
        <li >
            <a href="/support/" event="autotrack-data-g" data-g-event="Global Nav" data-g-action="Nav Bar" data-g-label="Support">
            Suporte
            </a>
        </li>
        <li >
            <a href="/partners/" event="autotrack-data-g" data-g-event="Global Nav" data-g-action="Nav Bar" data-g-label="Partners">
            Partners
            </a>
        </li>
         <li >
            <a href="http://googlecloudplatform.blogspot.com/" event="autotrack-data-g" data-g-event="Global Nav" data-g-action="Nav Bar" data-g-label="Blog">
            Blog
            </a>
        </li>
      </ul>
    </div>
  </div>

<!-- Products subnav -->
<div id="maia-nav-x" class="maia-nav products-nav">
  <div class="maia-aux">
    <div class="products-nav-dropdown maia-cols">

      <div id="compute-dropdown" class="products-column maia-col-2">
        <span class="product-list-title">Compute</span>
        <div class="dropdown-item-container">
          <a href="/products/compute-engine/">
            <span class="product-name">Compute Engine</span>
          </a>
        </div>
        <div class="dropdown-item-container">
          <a href="/products/app-engine/">
            <span class="product-name">App Engine</span>
          </a>
        </div>
      </div>

      <div id="storage-dropdown" class="products-column maia-col-2">
        <span class="product-list-title">Storage</span>
        <div class="dropdown-item-container">
          <a href="/products/cloud-sql/">
            <span class="product-name">Cloud SQL</span>
          </a>
        </div>
        <div class="dropdown-item-container">
          <a href="/products/cloud-storage/">
            <span class="product-name">Cloud Storage</span>
          </a>
        </div>
        <div class="dropdown-item-container">
          <a href="/products/cloud-datastore/">
            <span class="product-name">Cloud Datastore</span>
          </a>
        </div>
      </div>

      <div id="big-data-dropdown" class="products-column maia-col-2">
        <span class="product-list-title">Big Data</span>
        <div class="dropdown-item-container">
          <a href="/products/bigquery/">
            <span class="product-name">BigQuery</span>
          </a>
        </div>
      </div>

      <div id="services-dropdown" class="products-column maia-col-2">
        <span class="product-list-title">Services</span>
        <div class="dropdown-item-container">
          <a href="/products/cloud-dns/">
            <span class="product-name">Cloud DNS</span>
          </a>
        </div>
        <div class="dropdown-item-container">
          <a href="/products/cloud-endpoints/">
            <span class="product-name">Cloud Endpoints</span>
          </a>
        </div>
        <div class="dropdown-item-container">
          <a href="/products/translate-api/">
            <span class="product-name">Translate API</span>
          </a>
        </div>
        <div class="dropdown-item-container">
          <a href="/products/prediction-api/">
            <span class="product-name">Prediction API</span>
          </a>
        </div>
        <div class="dropdown-item-container">
          <a href="/products/cloud-pubsub/">
            <span class="product-name">Cloud Pub/Sub</span>
          </a>
        </div>
      </div>

      <div id="management-dropdown" class="products-column maia-col-2">
        <span class="product-list-title">Management</span>
        <div class="dropdown-item-container">
          <span class="product-name"><a href="/products/cloud-deployment-manager/">Cloud Deployment Manager</a></span>
        </div>
      </div>

      <div id="pricing-dropdown" class="products-column maia-col-2">
        <span class="product-list-title">Pricing</span>
        <div class="dropdown-item-container">
          <span class="product-name"><a href="/products/pricing/">Overview</a></span>
        </div>
        <div class="dropdown-item-container">
          <span class="product-name"><a href="/products/calculator/">Calculator</a></span>
        </div>
      </div>
    </div>
  </div>
</div>

<!DOCTYPE html>
<html>
<head>
<title>Mobile Articles &amp; Mobile Development Guides — Google Cloud Platform</title>
<meta name="description" content="Read technical articles on mobile solutions with Google Cloud Platform. Mobile specific articles cover application development, mobile backend and mobile gaming.">
<meta name="hide_page_heading" value="true">
<meta name="full_width" value="true">
<meta name="top_category" value="developers">
<meta name="subcategory" value="articles">
<meta name="viewport" content="initial-scale=1, minimum-scale=1, width=device-width">
<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,300,400,600,700" rel="stylesheet">
<link href="/css/default.css" rel="stylesheet"><!--[if lt IE 9]>
    <link rel="stylesheet" media="screen" href='/css/cp-ie.css'>
    <![endif]-->
<script src="/js/floodlight.js">
</script>
</head>
<body>
<div id="maia-main" class="cp-article">
<div class="maia-cols">
<div class="maia-col-9">
<div>
<div style="float:right">
<div class="g-plusone"></div>
</div>
<h1 class="title">Mobile Backend Starter: guia da API</h1>
</div>
<div class="cp-article-tutorial">
<h2>Apresentação</h2>
<p>O aplicativo de exemplo Mobile Backend Starter é uma ferramenta para criar seu próprio back-end na nuvem no Google App Engine e desenvolver aplicativos para Android que funcionem com esse back-end. Este artigo é uma visão detalhada sobre a Cloud Backend API e a Android client API, usadas pelo aplicativo de exemplo Mobile Backend Starter. O aplicativo de exemplo inclui acesso fácil ao armazenamento de dados, consulta contínua, padrão de mensagens publicar/subscrever (pub/sub) e o modelo de segurança.</p>
<h2>Conteúdo</h2>
<a href="#cbao">Visão geral da Cloud Backend API</a><br>
<a href="mobile-backend-starter-the-best-mix-of-baas-and-paas-1.html">Mobile Backend Starter: a melhor combinação de BaaS e PaaS</a><br>
<a href="#dawcb">(A) Acesso ao armazenamento de dados com a Cloud Backend API</a><br>
<a class="indnt" href="#pdice">Inserção de dados na CloudEntity</a><br>
<a class="indnt" href="#cep">Propriedades da CloudEntity</a><br>
<a class="indnt" href="#sdt">Tipos de dados suportados</a><br>
<a class="indnt" href="#ecbc">Execução do CRUD pela CloudBackend</a><br>
<a class="indnt" href="#eqbcqaf">Execução de consultas pela CloudQuery e F</a><br>
<a class="indnt" href="#roq">Restrições na consulta</a><br>
<a href="#adaacq">(B) Acesso assíncrono ao armazenamento de dados e consulta contínua</a><br>
<a class="indnt" href="#acaq">CRUD assíncrono e consulta</a><br>
<a class="indnt" href="#contqu">Consulta contínua</a><br>
<a class="indnt" href="#rocq">Restrições na consulta contínua</a><br>
<a href="#psm">(C) Padrão de mensagens publicar/subscrever</a><br>
<a class="indnt" href="#reascm">Recebimento e envio de mensagens na nuvem</a><br>
<a class="indnt" href="#rom">Recebimento de mensagens off-line</a><br>
<a class="indnt" href="#bmta">Transmissão de mensagens para as classes Activity</a><br>
<a href="#secmod">(D) Modelo de segurança</a><br>
<a class="indnt" href="#ciagaa">Autenticação da Conta do Google e ID do cliente</a><br>
<a class="indnt" href="#acfce">Controle de acesso para entidades de nuvem</a><br>
<a class="indnt" href="#easysec">Segurança fácil</a><br>
<a href="#pdn">Observações sobre o desenvolvimento de produção</a><br>
<a class="indnt" href="#packnames">Nomes de pacote</a><br>
<a class="indnt" href="#extendbackend">Extensão do Backend</a><br>
<a class="indnt" href="#locba">Limitações da CloudBackendActivity</a><br>
<a class="indnt" href="#cqsub">Inscrição da consulta contínua</a><br>
<a href="#conclusion">Conclusão</a>
<h2><a name="cbao" id="cbao"></a>Visão geral da Cloud Backend API</h2>
<p>O primeiro artigo desta série de duas partes foi o <a href="mobile-backend-starter-the-best-mix-of-baas-and-paas-1.html">Mobile Backend Starter: a melhor combinação de BaaS e PaaS.</a> Ele explicou sobre os recursos e conceitos gerais do aplicativo de exemplo Mobile Backend Starter e como começar a usá-lo. As instruções incluíam como implantar o back-end e configurar os recursos principais usando o aplicativo de exemplo. Este artigo analisa cada classe na Cloud Backend API usada no aplicativo de exemplo. Ele descreve como usá-las para criar seu próprio aplicativo cliente para Android usando esses recursos.</p>
<p>A seguir estão os principais recursos e classes de suporte incluídas na Cloud Backend API. O "F" na lista e no diagrama significa "filtro". Ele deixa o código o mais compacto possível, uma vez que a classe pode ser usada várias vezes em uma linha para compor uma consulta complexa.</p>
<ul>
<li>(A) Acesso ao armazenamento de dados
<ul>
<li>CloudBackend</li>
<li>CloudEntity</li>
<li>CloudQuery</li>
<li>F</li>
</ul>
</li>
<li>(B) Acesso assíncrono ao armazenamento de dados e consulta contínua
<ul>
<li>CloudBackendAsync</li>
</ul>
</li>
<li>(C) Padrão de mensagens publicar/subscrever (pub/sub)
<ul>
<li>CloudBackendMessaging</li>
</ul>
</li>
<li>(D) Modelo de segurança
<ul>
<li>CloudBackendActivity</li>
</ul>
</li>
<li>Exemplos
<ul>
<li>GuestbookActivity</li>
<li>SocialTalkActivity<br></li>
</ul>
</li>
</ul>
<figure><img src="/images/articles/mobile-backend-starter-baas-paas/securitymodel.png" alt="">
<figcaption>Figura 1: diagrama de classes da Cloud Backend API</figcaption>
</figure>
<h2><a name="dawcb" id="dawcb"></a>(A) Acesso ao armazenamento de dados com a Cloud Backend API</h2>
<p>A função principal da Cloud Backend API é tornar um subconjunto de recursos do <a href="https://developers.google.com/appengine/docs/java/datastore/overview">armazenamento de dados do App Engine</a> diretamente acessíveis pelos clientes. Não é necessário escrever códigos do lado do servidor para executar operações de criação, leitura, atualização e exclusão (CRUD, na sigla em inglês) e consultas no armazenamento de dados.</p>
<figure><img src="/images/articles/mobile-backend-starter-baas-paas/api-classes.png" alt="">
<figcaption>Figura 2: classes da Cloud Backend API</figcaption>
</figure>
<h3><a name="pdice" id="pdice"></a>Inserção de dados na CloudEntity</h3>
<p>Na Cloud Backend API, a entidade de armazenamento de dados é representada por uma classe chamada <span class="code">CloudEntity</span>. Para criar uma nova instância de <span class="code">CloudEntity</span>, escreva o código desta maneira:</p>
<pre>
CloudEntity ce = new CloudEntity("MyAddressBook");
ce.put("name", "John Smith");
ce.put("label", "friends");
ce.put("address", "1600 Amphitheatre Parkway, Mountain View, CA 94043");
</pre>
<p>A <span class="code">CloudEntity</span> é uma classe de contêiner como o java.util.Map. O código cria uma nova instância ao especificar o nome do tipo “MyAddressBook” e inserir valores em propriedades, nome, rótulo e endereço definidos pelo usuário. O armazenamento de dados não possui esquema, característica também conhecida como esquema flexível. Não é necessário predefinir esquemas no back-end antes de armazenar entidades. E cada entidade em um tipo pode ter diferentes conjuntos de propriedades.</p>
<p>Para inserir a <span class="code">CloudEntity</span> no armazenamento de dados do back-end, use a classe <span class="code">CloudBackend</span>.</p>
<pre>
CloudBackend cb = new CloudBackend();
cb.insert(ce);
</pre>
<p>Esse código emite uma solicitação HTTP para o back-end que acessa o armazenamento de dados para inserir a entidade. Discutiremos sobre os detalhes das funções da <span class="code">CloudBackend</span> posteriormente nesta seção.</p>
<h3><a name="cep" id="cep"></a>Propriedades da CloudEntity</h3>
<p>As propriedades da classe CloudEntity são mostradas na tabela abaixo. É possível acessar cada propriedade pelos métodos getter e setter, como no caso de getKindName().</p>
<table>
<thead>
<tr>
<th style="width:25%;">Nome da propriedade</th>
<th style="width:75%;">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td>kindName</td>
<td>Nome do tipo da entidade. Obrigatório</td>
</tr>
<tr>
<td>id</td>
<td>ID da entidade. Se nenhum ID for definido antes da inserção, um UUID aleatório será gerado automaticamente. Também é possível especificar um ID explicitamente antes da inserção. O ID da entidade não pode ser alterado posteriormente</td>
</tr>
<tr>
<td>properties</td>
<td>Um conjunto de propriedades definidas pelo usuário. É possível acessar cada propriedade pelos métodos put(String key, Object value), get(String key) e remove(String key).</td>
</tr>
<tr>
<td>createdAt*</td>
<td>Timestamp da criação da entidade</td>
</tr>
<tr>
<td>createdBy*</td>
<td>Endereço de e-mail do usuário que criou a entidade</td>
</tr>
<tr>
<td>updatedAt*</td>
<td>Timestamp da última atualização da entidade</td>
</tr>
<tr>
<td>updatedBy*</td>
<td>Endereço de e-mail do usuário que atualizou a entidade</td>
</tr>
<tr>
<td>owner*</td>
<td>
<p>UserId do proprietário da entidade. O UserId é um ID único em um aplicativo de exemplo de introdução ao back-end para dispositivos móveis, que é atribuído automaticamente a cada Conta do Google.</p>
</td>
</tr>
</tbody>
</table>
<p>* Essas propriedades são geradas automaticamente no back-end e são somente leitura. Ao usá-las com CloudQuery para filtragem ou classificação, insira um prefixo de sublinhado ("_") ao nome, como em "_createdAt", para diferenciá-las das propriedades definidas pelo usuário.</p>
<h3><a name="sdt" id="sdt"></a>Tipos de dados suportados</h3>
<p>Os tipos de dados a seguir são suportados pelas propriedades definidas pelo usuário. Cada entidade de nuvem pode conter até aproximadamente 1 MB de dados.</p>
<table>
<thead>
<tr>
<th style="width:25%">Tipo de dado</th>
<th style="width:75%">Observação</th>
</tr>
</thead>
<tbody>
<tr>
<td>String</td>
<td>Até 500 caracteres Unicode</td>
</tr>
<tr>
<td>Número inteiro</td>
<td>Convertido para BigDecimal ao ler o valor a partir do back-end</td>
</tr>
<tr>
<td>Duplo/flutuante</td>
<td>Convertido para BigDecimal ao ler o valor a partir do back-end</td>
</tr>
<tr>
<td>Booleano</td>
<td>Com valores true ou false</td>
</tr>
<tr>
<td>DateTime</td>
<td>Objeto com.google.api.client.util.DateTime. É convertido em uma string ao ler o valor do back-end</td>
</tr>
<tr>
<td>List/Map</td>
<td>Objeto java.util.List ou java.util. Map que pode conter strings com mais de 500 caracteres e List/Map filho. Os elementos não são indexados no armazenamento de dados e não podem ser usados como uma condição de filtragem/classificação de consulta. List/Map vazios não são salvos no armazenamento de dados</td>
</tr>
<tr>
<td>nulo</td>
<td>Não suportado. Se você definir uma propriedade com o tipo de dados "nulo", ela não será salva no armazenamento de dados.</td>
</tr>
</tbody>
</table>
<h3><a name="ecbc" id="ecbc"></a>Execução do CRUD pela CloudBackend</h3>
<p>A classe <span class="code">CloudBackend</span> fornece a função de consulta e CRUD. Use a <span class="code">CloudBackend</span> ao criar uma instância desta forma:</p>
<pre>
&lt;...prepare for CloudEntity instance to insert...&gt;
CloudBackend cb = new CloudBackend();
cb.insert(cloudEntity);
</pre>
<p>Todos os métodos funcionam de maneira síncrona. O thread de chamada fica bloqueado até o back-end retornar uma resposta. Portanto, os métodos não podem ser chamados diretamente por threads de IU (interface de usuário), como manipuladores de evento na classe <span class="code">Activity</span>. Use a classe <span class="code">CloudBackendAsync</span> ou a AsyncTask/Thread. Discutiremos sobre isso posteriormente.</p>
<a href="#" name="ae658cbe34291edb447f83456aa93c066aa51fab" id="ae658cbe34291edb447f83456aa93c066aa51fab"></a><a href="#" name="4" id="4"></a>
<table>
<thead>
<tr>
<th style="width:40%;">
<p>Método</p>
</th>
<th style="width:60%;">
<p>Descrição</p>
</th>
</tr>
</thead>
<tbody>
<tr>
<td class="code">insert(CloudEntity) update(CloudEntity) insertAll(List&lt;CloudEntity&gt;) updateAll(List&lt;CloudEntity&gt;)</td>
<td>Se o ID não estiver especificado ou não for encontrado no armazenamento de dados, a CloudEntity será inserida no armazenamento de dados. Se o ID for encontrado no armazenamento de dados, a CloudEntity existente será atualizada. As propriedades definidas pelo usuário modificam as propriedades existentes</td>
</tr>
<tr>
<td class="code">delete(CloudEntity) deleteAll(List&lt;CloudEntity&gt;)</td>
<td>Exclui a CloudEntity especificada do armazenamento de dados</td>
</tr>
<tr>
<td class="code">get(String, String) getAll(String, List&lt;String&gt;)</td>
<td>Lê a CloudEntity do armazenamento de dados ao especificar o kindName e o ID</td>
</tr>
<tr>
<td class="code">list(CloudQuery)</td>
<td>Executa uma consulta no armazenamento de dados para recuperar objetos da CloudEntity.</td>
</tr>
</tbody>
</table>
<p>As classes da Cloud Backend API não são thread-safe. Não chame os métodos com múltiplos threads simultaneamente.</p>
<h3><a name="eqbcqaf" id="eqbcqaf"></a>Execução de consultas pela CloudQuery e F</h3>
<p>A classe CloudBackend fornece o método list() para executar uma consulta no armazenamento de dados para recuperar objetos da CloudEntity, como mostrado neste código:</p>
<pre>
CloudQuery cq = new CloudQuery("MyAddressBook");
cq.setFilter(F.and(F.eq("name", "John Smith"), F.eq("label", "friends")));
cq.setLimit(50);
List&lt;CloudEntity&gt; results = cloudBackend.list(cq);
</pre>
<p>Para executar uma consulta, crie uma CloudQuery conforme descrito anteriormente. O objeto possui estes métodos:</p>
<table>
<thead>
<tr>
<th style="width:40%;">Método</th>
<th style="width:60%;">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="code">setFilter(F)</td>
<td>Define a filtragem na consulta com o objeto F</td>
</tr>
<tr>
<td class="code">setSort(String, Order)</td>
<td>Define a ordem e o nome da propriedade de classificação, ASC ou DESC</td>
</tr>
<tr>
<td class="code">setLimit(int)</td>
<td>Define o limite superior dos números do conjunto de resultados</td>
</tr>
<tr>
<td class="code">setScope(Scope)</td>
<td>Define o escopo da CloudQuery, que é definido como Scope.PAST por padrão. Dessa forma, a consulta é executada apenas nas entidades existentes no armazenamento de dados. Os detalhes sobre a consulta contínua são abordados em uma seção posterior</td>
</tr>
</tbody>
</table>
<p>Ao usar o método <span class="code">setFilter()</span>, é possível adicionar condições de filtragem expressas em um objeto F. F pode expressar um filtro para uma única propriedade, como name = "John Smith"). F também pode expressar uma árvore de subfiltros mais complexa, como em name = "John Smith" e label = "friends". Use estes métodos estáticos:</p>
<table style="width:100%;">
<thead>
<tr>
<th style="width:40%;">Método</th>
<th style="width:60%;">Condição de filtragem</th>
</tr>
</thead>
<tbody>
<tr>
<td>F.eq(String, Object)</td>
<td>&lt;nome da propriedade&gt; = &lt;valor da propriedade&gt;</td>
</tr>
<tr>
<td>F.ne(String, Object)</td>
<td>&lt;nome da propriedade&gt; <span class="bld">!</span>= &lt;valor da propriedade&gt;</td>
</tr>
<tr>
<td>F.lt(String, Object)</td>
<td>&lt;nome da propriedade&gt; &lt; &lt;valor da propriedade&gt;</td>
</tr>
<tr>
<td>F.le(String, Object)</td>
<td>&lt;nome da propriedade&gt; &lt;= &lt;valor da propriedade&gt;</td>
</tr>
<tr>
<td>F.gt(String, Object)</td>
<td>&lt;nome da propriedade&gt; &gt; &lt;valor da propriedade&gt;</td>
</tr>
<tr>
<td>F.ge(String, Object)</td>
<td>&lt;nome da propriedade&gt; &gt;= &lt;valor da propriedade&gt;</td>
</tr>
<tr>
<td>F.in(String, List&lt;Objeto&gt;)<br>
F.in(String, Objeto...)</td>
<td>&lt;nome da propriedade&gt; <span class="bld">IN</span> (&lt;valor da propriedade&gt;, ... )</td>
</tr>
<tr>
<td>F.and(F...)</td>
<td>F <span class="bld">AND</span> F <span class="bld">AND</span> ...</td>
</tr>
<tr>
<td>F.or(F...)</td>
<td>F <span class="bld">OR</span> F <span class="bld">OR</span> ...</td>
</tr>
</tbody>
</table>
<h3><a name="roq" id="roq"></a>Restrições na consulta</h3>
<p>Para outras formas, você recebe uma DatastoreNeedIndexException do back-end. Para usar uma forma mais complexa de consulta, adicione a <a href="https://developers.google.com/appengine/docs/java/datastore/indexes#Index_Configuration">Configuração de índice</a> ao back-end. Consulte o <a href="https://developers.google.com/samples/mbs/">documento sobre o Mobile Backend Starter</a> para encontrar detalhes sobre a personalização. É importante entender que as consultas na Cloud Backend API têm algumas restrições derivadas do armazenamento de dados do App Engine. Por padrão, o App Engine cria automaticamente um índice para cada propriedade definida pelo usuário, com exceção das propriedades List/Map. Esse índice trata destas formas de consulta:</p>
<ul>
<li>Consultas usando apenas um nome de tipo, sem filtros ou classificação</li>
<li>Consultas usando apenas filtros de igualdade (F.eq) nas propriedades indexadas, sem classificação</li>
<li>Consultas usando apenas filtros de desigualdade como F.lt ou F.ge, em uma propriedade indexada</li>
<li>Consultas usando uma ordem de classificação em uma propriedade, sem filtros</li>
</ul>
<p>Para encontrar mais informações sobre as consultas do armazenamento de dados do App Engine e suas restrições, consulte o documento sobre <span class="c62"><a href="https://developers.google.com/appengine/docs/java/datastore/queries#Restrictions_on_Queries">Restrições nas consultas</a>. Para encontrar detalhes sobre os preços do Google App Engine, consulte o documento <a href="https://developers.google.com/appengine/docs/billing">Aplicativos pagos: orçamento, faturamento e compra de recursos</a>.</span></p>
<p><span class="c62">A consulta garante apenas resultados com <a href="http://en.wikipedia.org/wiki/Eventual_consistency">consistência eventual</a>. Os status mais recentes da CloudEntities não são garantidos. Além disso, no momento, a Cloud Backend API não oferece suporte a transações. Para garantir a <a href="http://en.wikipedia.org/wiki/Strong_consistency">consistência forte</a> ou usar transações, personalize o back-end para usar um grupo de entidades e uma consulta de ancestral. Consulte <a href="https://developers.google.com/appengine/docs/java/datastore/structuring_for_strong_consistency">Estruturação de dados para consistência forte</a> e <a href="https://developers.google.com/appengine/docs/java/datastore/transactions">Transações</a> para encontrar detalhes.</span></p>
<h2><span class="c62"><a name="adaacq" id="adaacq"></a>(B) Acesso assíncrono ao armazenamento de dados e consulta contínua</span></h2>
<p><span class="c62">Todos os métodos de consulta e CRUD da CloudBackend são síncronos e não podem ser usados diretamente dos threads de IU do Android. Use a classe <span class="code">CloudBackendAsync</span> para utilizar esses métodos do thread de IU do fragmento ou da classe Activity</span></p>
<h3><a name="acaq" id="acaq"></a>CRUD assíncrono e consulta</h3>
<p>A <span class="code">CloudBackendAsync</span> é uma subclasse da <span class="code">CloudBackend</span> que fornece versões assíncronas dos métodos de consulta e CRUD. Por exemplo, use o código a seguir para executar uma consulta em <span class="code">Activity</span> com o thread de IU:</p>
<pre>
cloudBackendAsync.list(cloudQuery,
  new CloudCallbackHandler&lt;List&lt;CloudEntity&gt;&gt;() {
    @Override
    public void onComplete(List&lt;CloudEntity&gt; results) {
      &lt;update UI with the results&gt;
    }
});
</pre>
<p>O método <span class="code">list()</span> da <span class="code">CloudBackendAsync</span> usa o segundo parâmetro, <span class="code">CloudCallbackHandler</span>, como um manipulador. Esse manipulador é chamado novamente no thread de IU após receber o resultado do back-end. Da mesma forma que ocorre com o código discutido anteriormente, é possível escrever uma classe interna anônima que implementa o método <span class="code">CloudCallbackHandler’s onComplete()</span>. Além disso, é possível escrever um código para atualizar componentes de IU com os resultados. Ao implementar o método <span class="code">onError()</span> no gerenciador, também é possível capturar uma IOException do back-end em caso de erros de rede ou qualquer exceção causada pelo back-end. Esta lista contém os métodos disponíveis na <span class="code">CloudBackendAsync</span>:</p>
<table>
<thead>
<tr>
<th style="width:50%;">Métodos</th>
<th style="width:50%;">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="code">insert(CloudEntity, CloudCallbackHandler)<br>
insertAll(List&lt;CloudEntity&gt;, CloudCallbackHandler)<br>
update(CloudEntity, CloudCallbackHandler)<br>
updateAll(List&lt;CloudEntity&gt;, CloudCallbackHandler)<br>
get(CloudEntity, CloudCallbackHandler)<br>
getAll(List&lt;CloudEntity&gt;, CloudCallbackHandler)<br>
delete(CloudEntity, CloudCallbackHandler)<br>
deleteAll(List&lt;CloudEntity&gt;, CloudCallbackHandler)<br></td>
<td>Executa a operação de CRUD de maneira assíncrona. Os resultados são transmitidos para o gerenciador especificado.Se você transmitir "nulo" como gerenciador, não ocorrerão retornos de chamada</td>
</tr>
<tr>
<td class="code">list(CloudQuery, CloudCallbackHandler)</td>
<td>Executa uma consulta de maneira assíncrona</td>
</tr>
<tr>
<td class="code">listByProperty(String, String, Op, Object, Order, int, Scope, CloudCallbackHandler)</td>
<td>Executa uma consulta de maneira assíncrona com filtragem e classificação por uma única propriedade. É possível especificar um nome de tipo, um nome de propriedade, um valor e uma operação para filtragem, uma ordem de classificação, uma contagem de limite, o escopo e um gerenciador</td>
</tr>
<tr>
<td class="code">listByKind(String, String, Order, int, Scope, CloudCallbackHandler)</td>
<td>Executa uma consulta de maneira assíncrona com classificação por uma única propriedade. É possível especificar um nome de tipo, um nome de propriedade e uma ordem para classificação, uma contagem de limite e um gerenciador</td>
</tr>
<tr>
<td class="code">getLastEntityOfKind(String, Scope, CloudCallbackHandler)</td>
<td>Lê apenas a última entidade do tipo especificado</td>
</tr>
</tbody>
</table>
<h3><a name="contqu" id="contqu"></a>Consulta contínua</h3>
<p>A CloudBackendAsync suporta a consulta contínua, que é <a href="http://en.wikipedia.org/wiki/Data-stream_management_system#Query_Processing">usada no processamento de fluxo</a> para aplicar a filtragem em dados em constante mudança. Com a consulta contínua na Cloud Backend API, você captura as atualizações nas entidades de nuvem no back-end e compartilha instantaneamente as alterações com todos os usuários on-line. Também é possível usá-la para ativar a programação orientada por eventos e a vinculação de dados entre os componentes de IU e as entidades no back-end. Esse uso oferece uma experiência do usuário interativa e ativa.</p>
<p>Para usar o recurso, defina Scope.FUTURE_AND_PAST ou Scope.FUTURE em um objeto CloudQuery com este código:</p>
<pre>
cloudQuery.setScope(<span class="bld">Scope.FUTURE_AND_PAST</span>);
</pre>
<p>Por padrão, o escopo de CloudQuery é definido como Scope.PAST. Esse padrão significa que a consulta é executada apenas em relação às entidades existentes no armazenamento de dados. Ao definir como Scope.FUTURE_AND_PAST, a consulta é executada novamente sempre que um usuário que compartilha o mesmo back-end insere ou atualiza entidades que correspondem à condição da consulta. Este é um exemplo:</p>
<pre>
CloudQuery cq = new CloudQuery("MyAddressBook");
cq.setFilter(F.eq("label", "friends"));
<span class="bld">cq.setScope(Scope.FUTURE_AND_PAST);</span>
List&lt;CloudEntity&gt; results = cloudBackendAsync.list(cq, handler);
</pre>
<p>Ao executar essa consulta, o gerenciador recebe o resultado da consulta executada nas entidades existentes. Quando, posteriormente, outro usuário insere ou atualiza qualquer entidade que corresponda à condição label = "friends", o back-end detecta essa alteração e envia uma notificação push para os clientes que emitiram a consulta usando <span class="code">Scope.FUTURE_AND_PAST</span>. A consulta é executada novamente de maneira automática. O manipulador recebe o resultado mais recente, que inclui inserções ou atualizações realizadas por outras pessoas. Este é um exemplo do código:</p>
<pre>
CloudEntity ce = new CloudEntity("MyAddressBook");
ce.put("name", "Foo Bar");
ce.put("label", "friends");
cb.insert(ce);
</pre>
<p>Quando o escopo da consulta é definido como Scope.FUTURE, a consulta recebe primeiro um resultado vazio. Os resultados da consulta são exibidos quando ocorre uma inserção/atualização correspondente.</p>
<p>É possível determinar a duração da consulta contínua ao definir o valor de segundos com o método <span class="code">CloudQuery#setSubscriptionDuration(int)</span>. Por padrão, a consulta contínua expira 24 horas após a última invocação explícita pelo cliente. Para remover as consultas contínuas existentes, use estes métodos na CloudBackendAsync:</p>
<table>
<tbody>
<tr>
<td class="code">unsubscribeFromQuery(String)</td>
<td>Cancela a inscrição de uma consulta contínua especificada pelo queryId</td>
</tr>
<tr>
<td class="code">clearAllSubscription()</td>
<td>Cancela a inscrição de todas as consultas contínuas</td>
</tr>
</tbody>
</table>
<p>Também é possível remover todas as consultas contínuas manualmente do link de configurações do Mobile Backend no menu de navegação do Console de administradores do App Engine.</p>
<p>O Mobile Backend Starter implementa a consulta contínua por meio da combinação da <a href="https://developers.google.com/appengine/docs/java/prospectivesearch/">Prospective Search API</a> e do <a href="http://developer.android.com/google/gcm/index.html">Google Cloud Messaging</a> no back-end. A condição de filtragem de CloudQuery é convertida em consultas de inscrição da Pesquisa prospectiva. No Console de administradores do App Engine, clique no link "Pesquisa prospectiva" do menu de navegação para ver o status das inscrições. Todos os serviços subjacentes usados pela consulta contínua são altamente escaláveis e disponíveis, o que significa que é possível projetar um sistema grande com milhares de consultas contínuas on-line.</p>
<h3><a name="rocq" id="rocq"></a>Restrições na consulta contínua</h3>
<p>No momento, a consulta contínua na propriedade de string oferece suporte apenas aos filtros de igualdade (F.eq e F.ne).</p>
<p>A Prospective Search API é altamente escalável e pode suportar uma grande quantidade de inscrições simultâneas, mas o Google App Engine possui um número máximo de inscrições por aplicativo. A cota atual é de 10.000. É possível monitorar o número de inscrições atuais na página "Detalhes da cota" do Console de administradores do App Engine. Caso você tenha um aplicativo que possa exceder esse limite, entre em contato conosco por meio do <a href="/support/packages">programa de suporte</a> para aumentar a cota antes de atingir o limite.</p>
<p>A Prospective Search API é um recurso experimental do App Engine. A consulta contínua também é experimental e sua função, compatibilidade e disponibilidade podem sofrer alterações.</p>
<h2><a name="psm" id="psm"></a>(C) Sistema de mensagens pub/sub</h2>
<p>A Cloud Backend API oferece suporte ao <a href="http://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern">padrão de mensagens publicar/subscrever</a> com a classe <span class="code">CloudBackendMessaging</span>, que é uma subclasse da <span class="code">CloudBackendAsync</span>. O padrão de mensagens de publicar/subscrever é um padrão de arquitetura de software que permite implementar facilmente a transmissão de mensagens de 1:N entre editores (remetentes da mensagem) e assinantes (destinatários da mensagem).</p>
<h3><a name="reascm" id="reascm"></a>Recebimento e envio de mensagens na nuvem</h3>
<p>Para escrever um aplicativo para Android que tenha uma sala de bate-papo, escreva o código a seguir em Activity para torná-la um assinante.</p>
<pre>
cloudBackendMessaging.<span class="bld">subscribeToCloudMessage("dog", handler)</span>;
cloudBackendMessaging.<span class="bld">subscribeToCloudMessage("cat", handler)</span>;
</pre>
<p>O método <span class="code">subscribeToCloudMessage()</span> assume o TopicId como o primeiro parâmetro. <span class="code">TopicId</span> pode ser uma string arbitrária que identifica qualquer grupo de clientes em um aplicativo. No exemplo acima, "dog" é usado como um <span class="code">TopicId</span> para receber todas as mensagens de bate-papo relacionadas ao termo "dog" por meio do gerenciador.</p>
<p>Para enviar uma mensagem da sua Activity como um editor, use este código:</p>
<pre>
CloudEntity ce = cloudBackendMessaging.createCloudMessage("dog");
ce.put("chatMessage", &lt;chat message typed by the user&gt;);
cloudBackendMessaging.sendCloudMessage(ce);
</pre>
<p>Para criar uma mensagem, use o método <span class="code">createCloudMessage()</span> e transmita o <span class="code">topicId</span> para receber uma <span class="code">CloudEntity</span> que represente a mensagem. Em seguida, use o método <span class="code">put()</span> para fornecer conteúdo para a mensagem. Use <span class="code">sendCloudMessage()</span> para enviar a mensagem para os assinantes.</p>
<p>No código do assinante, é possível escrever o gerenciador que é transmitido como o segundo parâmetro do método <span class="code">subscribeToCloudMessage()</span> desta forma:</p>
<pre>
CloudCallbackHandler&lt;List&lt;CloudEntity&gt;&gt; handler =
  new CloudCallbackHandler&lt;List&lt;CloudEntity&gt;&gt;() {
    @Override
    public void onComplete(List&lt;CloudEntity&gt; messages) {
      &lt;update UI with the messages&gt;
    }
  };
</pre>
<p>As mensagens recebidas são transmitidas para o método <span class="code">onComplete()</span> do gerenciador como uma lista da <span class="code">CloudEntity</span>. É possível escrever um código para atualizar os componentes de IU com as mensagens. Dessa forma, você implementa um aplicativo de bate-papo em tempo real com apenas algumas dezenas de linhas de código.</p>
<h3><a name="rom" id="rom"></a>Recebimento de mensagens off-line</h3>
<p>Após chamar o método <span class="code">subscribeToCloudMessage()</span>, o cliente recebe todas as mensagens enviadas após a subscrição. Às vezes, você deseja receber mensagens mais antigas enviadas para um tópico antes da adição da subscrição. Para recebê-las, especifique o terceiro parâmetro na chamada do método:</p>
<pre>
cloudBackendMessaging.subscribeToCloudMessage("dog", handler, 50);
</pre>
<p>O cliente pode receber até 50 mensagens antigas. Você pode receber todas as mensagens não recebidas devido à perda de conectividade ou inatividade do aplicativo cliente.</p>
<p>O Mobile Backend Starter implementa o recurso de sistema mensagens publicar/subscrever por meio do uso da consulta contínua. Ele cria uma consulta especial chamada <span class="code">_CloudMessages</span> no armazenamento de dados que salva todas as mensagens. A classe <span class="code">CloudBackendMessaging</span> recebe todas as inserções no tipo com o topicId especificado usando a consulta contínua. Todas as mensagens permanecem no armazenamento de dados e podem ser recuperadas posteriormente, mesmo se o aplicativo cliente perder a conexão com a rede.</p>
<p>O tipo <span class="code">_CloudMessages</span> resulta em um grande acúmulo de mensagens. Quando um aplicativo gera uma grande quantidade de mensagens, remova as mensagens mais antigas do tipo.</p>
<h3><a name="bmta" id="bmta"></a>Transmissão de mensagens para as classes Activity</h3>
<p>A Cloud Backend API possui a classe <span class="code">CloudBackendActivity</span>, que fornece o recurso de transmissão de mensagem com base no sistema de mensagens publicar/subscrever. <span class="code">GuestbookActivity</span> e <span class="code">SocialTalkActivity</span> são bons exemplos dessa classe.</p>
<p>Para usar a classe <span class="code">CloudBackendActivity</span>, comece definindo uma subclasse.</p>
<span>public class GuestbookActivity <span class="bld">extends CloudBackendActivity</span> { ...</span>
<p><span class="code">CloudBackendActivity</span> é uma subclasse, portanto, sua classe herdará todas as características de Activity. Para herdar outras classes Activity, como <span class="code">ListActivity</span> ou <span class="code">TabActivity</span>, modifique a definição de classe de <span class="code">CloudBackendActivity</span>.</p>
<p>A classe <span class="code">CloudBackendActivity</span> possui dois métodos de transmissão de mensagens, <span class="code">onBroadcastMessageReceived()</span> e <span class="code">createBroadcastMessage()</span>. No exemplo de GuestbookActivity, a classe modifica o método para receber as mensagens transmitidas e exibi-las como notificações do sistema.</p>
<pre>
@Override
public void <span class="bld">onBroadcastMessageReceived</span>(List&lt;CloudEntity&gt; l) {
  for (CloudEntity e : l) {
    String message = (String) e.get("message");
    int duration = Integer.parseInt((String) e.get("duration"));
    Toast.makeText(this, message, duration).show();
  }
}
</pre>
<p>O exemplo acima recupera a mensagem de propriedades e a <span class="bld">duração</span> da mensagem para exibir uma notificação do sistema com a mensagem pelo tempo determinado pela duração. É possível testar isso na seção "Enviar mensagem de nuvem" da página de configurações "Mobile Backend" no Console de administradores.</p>
<p><img src="/images/articles/mobile-backend-starter-baas-paas/messaging.png" alt=""></p>
<p>Abra o aplicativo Guestbook e clique em <span class="bld">"Enviar"</span>. Em seguida, você vê a mensagem como uma notificação do sistema no aplicativo.</p>
<p>A transmissão é apenas outra mensagem de nuvem com o <span class="code">topicId <span class="bld">_broadcast</span></span>. A classe <span class="code">CloudBackendActivity</span> se inscreve automaticamente no <span class="code">topicId</span> para receber todas as mensagens enviadas para o <span class="code">topicId</span>.</p>
<p>Use o método <span class="code">createBroadcastMessage()</span> do back-end dentro de Activity para criar uma mensagem de transmissão. Em seguida, chame o método <span class="code">sendCloudMessage()</span> do back-end com a mensagem.</p>
<pre>
CloudEntity ce = cb.<span class="bld">createBroadcastMessage()</span>;
ce.put("message", "my broadcast message");
ce.put("duration", "5");
cb.<span class="bld">sendCloudMessage(ce)</span>;
</pre>
<p>O código acima envia a mensagem para todas as classes Activity que estendem a <span class="code">CloudBackendActivity</span> e modifica o método <span class="code">onBroadcastMessageReceived()</span>. As propriedades "message" e "duration" aqui são apenas exemplos no aplicativo Guestbook. É possível inserir um conjunto de propriedades arbitrárias em uma mensagem de transmissão.</p>
<h2><a name="secmod" id="secmod"></a>(D) Modelo de segurança</h2>
<p>A Cloud Backend API possui dois tipos de segurança:</p>
<ul>
<li>Autenticação da Conta do Google e do ID do cliente</li>
<li>Controle de acesso para entidades de nuvem</li>
</ul>
<h3><a name="ciagaa" id="ciagaa"></a>Autenticação da Conta do Google e do ID do cliente</h3>
<p>Como mencionamos na seção "Primeiros passos", é possível definir configurações de autenticação/autorização como um dos três modos:</p>
<ul>
<li><span class="bld">Bloqueado</span>: todas as solicitações serão rejeitadas</li>
<li><span class="bld">Aberto</span>: todas as solicitações não autenticadas serão permitidas</li>
<li><span class="bld">Protegido por IDs do cliente</span>: apenas as chamadas autenticadas com o ID do cliente e com a Conta do Google são permitidas</li>
</ul>
<img src="/images/articles/mobile-backend-starter-baas-paas/authentication.png" alt="">
<p>Use o modo "Aberto" apenas para desenvolvimento. Não deixe essa configuração por muito tempo, pois ela permite chamadas não autenticadas. Qualquer pessoa que saiba o ID do projeto pode realizar uma chamada no back-end. Não use o modo "Aberto" na produção.</p>
<p>O modo "Protegido por IDs do cliente" é o melhor para ser usado na produção. Ele permite apenas chamadas autenticadas associadas com o seguinte:</p>
<ul>
<li>IDs do cliente registrados, que garantem que o cliente Android foi criado por seu ambiente de desenvolvimento e possui a assinatura registrada</li>
<li>Conta do Google, que demonstra que o Google autenticou o usuário solicitante</li>
</ul>
<p>Todas as chamadas originadas de um cliente que não tenha um ID do cliente ou uma Conta do Google receberão uma UnauthorizedException.</p>
<p>Por padrão, as chamadas das Cloud Backend APIs para o back-end não são associadas aos dados da Conta do Google. Para transmitir os dados da Conta do Google do usuário para o back-end em cada chamada, use o método <span class="code">CloudBackend#setCredential()</span>. Esse método também está disponível nas subclasses <span class="code">CloudBackendAsync</span> e <span class="code">CloudBackendMessaging</span>) para definir um objeto <span class="code">GoogleAccountCredential</span> antes de chamar as CloudBackend APIs. Este é um exemplo do código:</p>
<pre>
GoogleAccountCredential credential =
  GoogleAccountCredential.usingAudience(this, "<span class="code">&lt;Web Client ID&gt;</span>");
credential.setSelectedAccountName("<span class="code">&lt;Google Account Name&gt;</span>");
cloudBackend.<span class="code">setCredential</span>(credential);
</pre>
<p>No código acima, o back-end permite a chamada no modo "Protegido por ID do cliente". Ele também define automaticamente as propriedades createdBy/updatedBy/owner da <span class="code">CloudEntity</span>. Para saber mais sobre como o cliente cria um objeto <span class="code">GoogleAccountCredential</span>, como, por exemplo, mostrando a caixa de diálogo "AccountPicker" para selecionar uma conta, consulte o documento <a href="https://developers.google.com/appengine/docs/java/endpoints/consume_android#making-authenticated-calls">Criação de chamadas autenticadas</a> ou o código fonte da classe <span class="code">CloudBackendActivity</span>.</p>
<h3><a name="acfce" id="acfce"></a>Controle de acesso para entidades de nuvem</h3>
<p>A Cloud Backend API oferece um recurso de controle de acesso nas CloudEntities. É possível especificar o controle de acesso ao adicionar um dos prefixos a seguir no nome do tipo das entidades.</p>
<table style="width:100%;">
<thead>
<tr>
<th style="width:25%;">Prefixo do nome do tipo</th>
<th style="width:25%;">get/query</th>
<th style="width:25%;">update/delete</th>
<th style="width:25%;">insert</th>
</tr>
</thead>
<tbody>
<tr>
<td>[private]</td>
<td>proprietário da entidade</td>
<td>proprietário da entidade</td>
<td>qualquer pessoa</td>
</tr>
<tr>
<td>sem prefixo</td>
<td>qualquer pessoa</td>
<td>proprietário da entidade</td>
<td>qualquer pessoa</td>
</tr>
<tr>
<td>[public]</td>
<td>qualquer pessoa</td>
<td>qualquer pessoa</td>
<td>qualquer pessoa</td>
</tr>
</tbody>
</table>
<p>Por exemplo, o nome do tipo "MyAddressBook" permite que qualquer pessoa insira entidades e receba/consulte as entidades existentes. Mas apenas os proprietários das entidades podem atualizá-las ou excluí-las. Se um usuário tentar atualizar a entidade de outra pessoa, o back-end emite uma <span class="code">UnauthorizedException</span>. Se você não deseja que as entidades MyAddressBook possam ser lidas por todos, nomeie o tipo como "[private]MyAddressBook". Uma consulta com base no tipo para conseguir uma lista de todas as entidades recebe apenas as entidades pertencentes ao usuário que realiza a consulta. As entidades em tipos [private] são <a href="https://developers.google.com/appengine/docs/java/multitenancy/multitenancy#Creating_Namespaces_on_a_per_User_Basis">armazenadas com um namespace diferente</a> para cada Conta do Google, garantindo o isolamento entre os usuários.</p>
<p>Se você criar um tipo chamado "[public]Guestbook", todas as entidades poderão ser lidas e gravadas por qualquer pessoa. Todas as entidades sem um UserID válido atribuído para a propriedade owner poderão ser lidas e gravadas por qualquer pessoa também.</p>
<p>Todas as solicitações e respostas trocadas entre um cliente Android e o back-end são protegidas por uma conexão https. Porém, os valores das CloudEntities não são criptografados no armazenamento do back-end e não devem ser usados para armazenar informações confidenciais, como dados financeiros ou relacionados à saúde. Além disso, é possível estender o <a href="https://github.com/GoogleCloudPlatform/solutions-mobile-backend-starter-java">código fonte do back-end</a> para implementar a criptografia dos dados antes do armazenamento.</p>
<h3><a name="easysec" id="easysec"></a>Segurança fácil</h3>
<p>Para a segurança por autenticação do ID do cliente e da Conta do Google, normalmente é necessário escrever <a href="https://developers.google.com/appengine/docs/java/endpoints/consume_android#making-authenticated-calls">muitas linhas de código</a>. O código permite:</p>
<ul>
<li>Criar um objeto GoogleAccountCredential e transmiti-lo para a CloudBackend</li>
<li>Mostrar a caixa de diálogo "AccountPicker" para permitir que o usuário selecione uma Conta do Google</li>
<li>Modificar o método <span class="code">onActivityResult()</span> para receber um resultado da <span class="code">AccountPicker</span> e defini-lo para o <span class="code">GoogleAccountCredential</span></li>
<li>Salvar um nome de conta selecionado em <span class="code">SharedPreference</span> e fazer com que ele seja lembrado quando o aplicativo for aberto novamente</li>
</ul>
<p>A Cloud Backend API inclui uma classe <span class="code">CloudBackendActivity</span> que realiza todas essas tarefas para você. As classes <span class="code">GuestbookActivity</span> e <span class="code">SocialTalkActivity</span> são bons exemplos.</p>
<p>Para usar a <span class="code">CloudBackendActivity</span>, defina uma subclasse:</p>
<pre>
public class GuestbookActivity <span class="bld">extends CloudBackendActivity</span> {
...
</pre>
<p><span class="code">CloudBackendActivity</span> é uma subclasse da classe <span class="code">Activity</span>. Sua classe herda todas as características da classe Activity. Para herdar outras classes <span class="code">Activity</span>, como <span class="code">ListActivity</span> ou <span class="code">TabActivity</span>, modifique a definição de classe de <span class="code">CloudBackendActivity</span>.</p>
<p>Na classe <span class="code">Activity</span>, modifique o método <span class="code">isAuthEnabled()</span> para retornar o valor true para ativar os recursos de segurança.</p>
<pre>
@Override
public boolean <span class="bld">isAuthEnabled()</span> {
  return <span class="bld">true</span>;
}
</pre>
<p>Também é possível modificar o método <span class="code">onPostCreate()</span> para executar as tarefas de inicialização que usam a Cloud Backend API e os recursos de segurança. Esses recursos e APIs ficam indisponíveis até o <span class="code">onPostCreate()</span> ser chamado.</p>
<pre>
@Override
protected void <span class="bld">onPostCreate()</span> {
  super.onPostCreate();
  &lt;do initialization&gt;
}
</pre>
<p>O método é chamado após <span class="code">Activity</span> mostrar a <span class="code">"AccountPicker"</span> para o usuário e ele realizar a seleção ou após <span class="code">Activity</span> recuperar o nome da conta selecionado anteriormente em <span class="code">SharedPreference</span>. O <span class="code">onPostCreate()</span> é chamado após a autenticação do usuário ser concluída e está pronto para usar todos os recursos da Cloud Backend API. No Guestbook, por exemplo, o aplicativo executa a primeira consulta para ler as postagens mais recentes do livro de visitas e exibi-las na IU.</p>
<pre>
@Override
protected void <span class="bld">onPostCreate()</span> {
  super.onPostCreate();
  <span class="bld">getCloudBackend()</span>.listByKind("Guestbook", CloudEntity.PROP_CREATED_AT,
    Order.DESC, 50, Scope.FUTURE_AND_PAST, handler);
}
</pre>
<p>Para chamar as Cloud Backend APIs dentro da classe Activity, use <span class="code">getCloudBackend()</span> para receber uma instância de CloudBackendMessaging. Chame também as APIs assíncronas implementadas pela <span class="code">CloudBackendAsync</span> com o <span class="code">CloudCallbackHandler</span>. Com essa chamada, os dados da Conta do Google são associados à solicitação e é possível receber todos os recursos de segurança descritos acima.</p>
<h2><a name="pdn" id="pdn"></a>Observações sobre o desenvolvimento de produção</h2>
<h3><a name="packnames" id="packnames"></a>Nomes de pacote</h3>
<p>Por padrão, o cliente Android do Mobile Backend Starter tem o nome de pacote “com.google.cloud.backend.android”. Ao desenvolver seu aplicativo, edite o AndroidManifest.xml para alterar estas partes de acordo com seu nome de pacote:</p>
<ul>
<li>O atributo "package" do elemento "manifest" na linha 3</li>
<li>O atributo "name" do elemento "permission" na linha 12</li>
<li>O atributo "name" do elemento "users-permission" na linha 16</li>
<li>O atributo "name" do elemento "activity" na linha 29. Altere-o para sua Activity</li>
<li>O atributo "name" do elemento "service" na linha 46. Também copie a classe <span class="code">GCMIntentService</span> para seu pacote</li>
</ul>
<h3><a name="extendbackend" id="extendbackend"></a>Extensão do Backend</h3>
<p>Precisa de mais funções no lado do servidor? O código fonte do back-end do Mobile Backend Starter está publicado como um software de código aberto. Você pode estender a funcionalidade para criar seu próprio back-end. Consulte o <a href="https://github.com/GoogleCloudPlatform/solutions-mobile-backend-starter-java">README.md no GitHub</a> para encontrar detalhes.</p>
<h3><a name="locba" id="locba"></a>Limitações da CloudBackendActivity</h3>
<p>No momento, os recursos do modelo de segurança estão expostos como uma CloudBackendActivity, que deve ser estendida. Ela pode entrar em conflito com outras estruturas que exijam a extensão de uma Activity diferente. As futuras implementações do Mobile Backend Starter podem fornecer um fragmento e/ ou serviços para remover essa limitação.</p>
<p>Seguindo o bom design do Android, todas as solicitações de rede são executadas de forma independente do thread de IU. Porém, as instâncias de CloudCallbackHandler criadas na sua Activity são perdidas quando a configuração do aplicativo é alterada, como a rotação da tela. Portanto, o código de exemplo do Guestbook bloqueia a Activity no modo retrato. Em vez de estender a CloudBackendActivity e chamar getCloudBackend() para remover essa limitação, é possível instanciar CloudBackendMessaging usando um fragmento com setRetainInstance(true). É provável que seja necessário realizar mais alterações para extrair completamente os ganchos de ciclo de vida, como onPostCreate().</p>
<h3><a name="cqsub" id="cqsub"></a>Inscrição da consulta contínua</h3>
<p>A consulta contínua cria "inscrições" no lado do servidor e no lado do cliente para acompanhar as alterações de dados da entidade e executar as consultas novamente. Na biblioteca cliente para Android do Mobile Backend Starter, cada inscrição é identificada pelo “ID de consulta” gerado com base na representação de uma string da condição de consulta. Mesmo se seu aplicativo para Android tiver diversas instâncias de Activity criadas, uma nova consulta na nova instância de Activity substitui a inscrição de consulta antiga de forma que haja um ID de consulta para cada consulta. Não é necessário chamar o CloudBackendAsync#clearAllSubscription() sempre para limpar as inscrições.</p>
<h2><a name="conclusion" id="conclusion"></a>Conclusão</h2>
<p>É possível usar a Cloud Backend API de exemplo do Mobile Backend Starter para criar aplicativos para dispositivos móveis rapidamente com o back-end. A API permite acessar o armazenamento de dados do App Engine com o mínimo de esforço. Ela também oferece recursos úteis, como as chamadas assíncronas, a consulta contínua, o padrão de mensagens publicar/subscrever e o modelo de segurança. Ao combinar esses recursos, é possível criar aplicativos para dispositivos móveis interativos e avançados com back-end em muito pouco tempo.</p>
</div>
<!-- /maia-main --></div>
<div class="maia-col-3"><br>
<img src="//www.google.com/images/icons/product/feedback-16.png" class="g-app-icon" alt=""> <a href="javascript:void(0);" class="google-feedback">Feedback sobre este documento</a><br>
<br>
<hr>
<h4>Mais informações</h4>
<ul>
<li><a href="mobile-backend-starter.html">Visão geral</a></li>
<li><a href="http://developers.google.com/samples/mbs/" target="popout">Primeiros passos<img src="/images/ext-link-8px.png" height="8px" width="8px" alt=""></a></li>
</ul>
<hr></div>
</div>
</div>
<script>
(function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script><script src="//www.gstatic.com/feedback/api.js">
</script><script>
$('body').delegate('.google-feedback', 'click', function() {
      userfeedback.api.startFeedback({'productId': '94614'});
  });
</script><!-- Scripts to include both on Goro + Devsite --><script>
window.___gcfg = {
     lang: ''
   };
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script><!-- GTM implementation --><!-- Start dataLayer --><script>
dataLayer = [{
        'country': 'None',
        'region': 'None',
        'language': 'pt-br'
      }];
</script><!-- End dataLayer --><!-- Start Google Tag Manager --><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5CVQBG" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <script>
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5CVQBG');
</script><!-- End Google Tag Manager --><!-- Global JS scripts to load; path will depend on whether we're on devsite or Goro --><script src="/js/base.min.js">
</script><!-- Retina loader; Do not load if partners page because we need to wait until the Angular app runs --><script>
new lfl.system.RetinaLoader();
</script><!-- Secondary right-side scroll-nav --><script>
new lfl.ui.ScrollNav({});
</script>
</body>
</html>

  <!-- Scripts to include both on Goro + Devsite -->
  <script type="text/javascript">
   window.___gcfg = {
     lang: ''
   };
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
  </script>

  <!-- GTM implementation -->

  <!-- Start dataLayer -->
    <script>
      dataLayer = [{
        'country': '',
        'region': '',
        'language': 'pt-BR'
      }];
    </script>
  <!-- End dataLayer -->

  <!-- Start Google Tag Manager -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5CVQBG"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5CVQBG');</script>
  <!-- End Google Tag Manager -->

  <!-- Global JS scripts to load; path will depend on whether we're on devsite or Goro -->
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular-sanitize.js"></script>

  <script src="/js/base.min.js"></script>

<!-- Secondary right-side scroll-nav -->
<script>
  new lfl.ui.ScrollNav({});
  new lfl.cloud.GlobalProductMenu();
</script>

<script>new cloud.SocialFeeds(document.getElementById('feeds'));</script>



  <div id="maia-signature"></div>
  <div id="maia-footer">

    <!-- maia-footer-local -->
    <div id="maia-footer-local">
      <div class="maia-aux">

          <div class="ent-footer-top">
  <div class="g-plus-wrapper">
    <div class="g-plusone" data-href="http://cloud.google.com"></div>
  </div>
  <div class="g-plus-link"><a href="https://plus.google.com/+googlecloudplatform" rel="publisher">Google+</a></div>
  <div class="search">
    <form onsumbit="return false;" class="maia-search" action="/search">
    <input name="q" placeholder="Search this site" type="text">
    <input name="hl" type="hidden" value="">
    <input name="q" type="hidden" value="site:cloud.google.com/">
    <button class="maia-button" event="autotrack-data-g" data-g-event="Footer" data-g-action="Site Search" data-g-label="Submit">
      <span class="maia-search-icon">Search</span>
    </button>
    </form>
  </div>

</div>

<div class="ent-footer-links">
  <div class="ent-footer-unit">
    <h4><a href="/why-google/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Why Google" data-g-label="Why Google">Why Google</a></h4>
    <ul>
      <li><a href="/why-google/#infrastructure" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Why Google" data-g-label="Infrastructure">Infrastructure</a></li>
      <li><a href="/why-google/#product" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Why Google" data-g-label="Product">Product</a></li>
      <li><a href="/why-google/#services" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Why Google" data-g-label="Services">Services</a></li>
      <li><a href="/why-google/#scalability" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Why Google" data-g-label="Scalability">Scalability</a></li>
      <li><a href="/why-google/#performance" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Why Google" data-g-label="Performance">Performance</a></li>
      <li><a href="/why-google/#support" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Why Google" data-g-label="Support">Support</a></li>
    </ul>
  </div>

  <div class="ent-footer-unit">
    <h4><a href="/products/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Products" data-g-label="Products">Products</a></h4>
    <ul>
      <li><a href="/products/app-engine/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Products" data-g-label="App Engine">App Engine</a></li>
      <li><a href="/products/compute-engine/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Products" data-g-label="Compute Engine">Compute Engine</a></li>
      <li><a href="/products/cloud-storage/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Products" data-g-label="Cloud Storage">Cloud Storage</a></li>
      <li><a href="/products/cloud-sql/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Products" data-g-label="Cloud SQL">Cloud SQL</a></li>
      <li><a href="/products/cloud-datastore/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Products" data-g-label="Cloud Datastore">Cloud Datastore</a></li>
      <li><a href="/products/bigquery/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Products" data-g-label="BigQuery">BigQuery</a></li>
      <li><a href="/products/prediction-api/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Products" data-g-label="Prediction API">Prediction API</a></li>
      <li><a href="/products/translate-api/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Products" data-g-label="Translate API">Translate API</a></li>
      <li><a href="/products/cloud-endpoints/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Products" data-g-label="Cloud Endpoints">Cloud Endpoints</a></li>
      <li><a href="/products/calculator/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Products" data-g-label="Pricing Calculator">Pricing Calculator</a></li>
      <li><a href="/pricing/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Products" data-g-label="Pricing">Pricing</a></li>
    </ul>
  </div>

  <div class="ent-footer-unit">
    <h4><a href="/solutions" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Solutions" data-g-label="Solutions">Solutions</a></h4>
    <ul>
      <li><a href="/solutions/mobile/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Solutions" data-g-label="Mobile">Mobile</a></li>
      <li><a href="/solutions/gaming/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Solutions" data-g-label="Gaming">Gaming</a></li>
      <li><a href="/solutions/hadoop/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Solutions" data-g-label="Hadoop">Hadoop</a></li>
      <li><a href="/solutions/mongodb/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Solutions" data-g-label="mongodb">MongoDB</a></li>
      <li><a href="/solutions/rabbitmq/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Solutions" data-g-label="rabbitmq">RabbitMQ</a></li>
      <li><a href="/solutions/cassandra/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Solutions" data-g-label="cassandra">Cassandra</a></li>
    </ul>
  </div>

  <div class="ent-footer-unit">
    <h4><a href="/customers/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Customers" data-g-label="Customers">Customers</a></h4>
  </div>

  <div class="ent-footer-unit">
    <h4><a href="/developers/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Developers" data-g-label="Developers">Developers</a></h4>
    <ul>
      <li><a href="/developers#documentation" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Developers" data-g-label="Documentation">Documentation</a></li>
      <li><a href="/developers#resources" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Developers" data-g-label="Resources">Resources</a></li>
    </ul>
  </div>

  <div class="ent-footer-unit">
    <h4><a href="/support/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Support" data-g-label="Support">Support</a></h4>
    <ul>
      <li><a href="https://support.google.com/" target="_blank" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Support" data-g-label="Google Cloud Platform Support Help Center">Platform Support Help Center</a></li>
      <li><a href="https://support.google.com/cloudbilling/" target="_blank" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Support" data-g-label="Google Cloud Billing Help Center">Billing Help Center</a></li>
      <li><a href="https://enterprise.google.com/supportcenter" target="_blank" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Support" data-g-label="Google Enterprise Support Center">Google Enterprise Support Center</a></li>
    </ul>

  </div>


  <div class="ent-footer-unit">
    <h4><a href="/partners/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Partners" data-g-label="Partners">Partners</a></h4>
    <ul>
      <li><a href="/partners/technology-partners/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Partners" data-g-label="Find A Technology Partner">Technology Partners</a></li>
      <li><a href="/partners/service-partners/" event="autotrack-data-g" data-g-event="Footer" data-g-action="Footer Links: Partners" data-g-label="Find A Service Partner">Service Partners</a></li>
    </ul>
  </div>

  </div>
  <br class="clear" />

  </div>
  </div>
    <!-- /maia-footer-local -->

    <!-- maia-footer-global -->
    <div id="maia-footer-global">
      <div class="maia-locales">
        <select name="language" 
        onchange="var lang=this[this.selectedIndex].value;if(lang!='')
        {window.location.href=window.location.pathname + '?hl=' + lang};">>
          <option value="en" >English</option>
          <option value="fr" >Français</option>
          <option value="de" >Deutsch</option>
          <option value="ja" >日本語</option>
          <option value="ko" >한국어</option>
          <option value="pt-br" >Português</option>
          <option value="es" >Español</option>
          <option value="zh-tw" >中文（繁體中文）</option>
        </select>
      </div>
      <div class="maia-aux">
        <ul>
          <li><a href="http://www.google.com/">Google</a></li>
          <li><a href="https://developers.google.com/readme/terms">Terms of Service</a></li>
          <li><a href="https://www.google.com/intl/pt-BR/policies/privacy/">Privacy Policy</a></li>
        </ul>
      </div>
    </div>
  </div>
  <!-- /maia-footer-global -->
  <script src="//www.google.com/js/maia.js"></script>
  <script type="text/javascript" async defer src="//www.gstatic.com/feedback/api.js"></script>
  <script id="jqueryui" src="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.10/jquery-ui.min.js"></script>
  </body>
</html>
